# Build an Interactive Dashboard App

This is the companion example for the [How to Build an Interactive Dashboard App](https://makoserver.net/articles/How-to-Build-an-Interactive-Dashboard-App) tutorial.

## Prepare (Install) the Example

You may install the required components using the automatic option or
the manual option. The manual installation option can be used on any
platform, including Windows.

### Automatic Installation

The script install.sh can automatically download and prepare the
example on the following platforms: Mac, Linux (Intel type CPU), and
Windows Subsystem for Linux (WSL).

1. Make sure 'curl' and 'git' are installed on your machine.
2. Run the following in a terminal window:
   bash <(curl -s https://raw.githubusercontent.com/RealTimeLogic/LSP-Examples/master/Dashboard/install.sh)
3. Navigate to http://localhost:port-number when the installation
   script starts the Mako Server. The port-number is the port number
   printed in the terminal window when the Mako Server starts.


### Manual Installation

You do not need to run the git commands below in a command window, but
you must make sure you create the same structure. The example requires
the original AdminLTE code. The script 'build.lua' extracts a number
of example pages from AdminLTE and copies the content into
AdminLTE.new with the format expected by the Mako Server powered
dashboard version.

1. Open a command window in a suitable directory
2. Download AdminLTE: git clone https://github.com/ColorlibHQ/AdminLTE.git
3. Download the LSP examples: git clone https://github.com/RealTimeLogic/LSP-Examples
4. Download [xlua for your platform](https://makoserver.net/download/overview/)
5. Run: (See the Notes section below for details on the script 'build.lua')
   - Win:   xlua LSP-Examples\Dashboard\build.lua AdminLTE
   - Linux: ./xlua LSP-Examples/Dashboard/build.lua AdminLTE
6. Copy all files in LSP-Examples/Dashboard/source/ to AdminLTE.new/ e.g.: cp -r LSP-Examples/Dashboard/source/. AdminLTE.new
7. Copy the two directories 'dist' and 'plugins' from AdminLTE/ to AdminLTE.new/

You should have the following file and directories in the root of AdminLTE.new/ after performing the above steps:

```
.preload  -- file
.lua      -- directory
dist      -- directory
plugins   -- directory
```

## Run the example, using the Mako Server, as follows:

```
mako -l::AdminLTE.new
```

See the [Mako Server command line video tutorial](https://youtu.be/vwQ52ZC5RRg) for more information on how to start the Mako Server.

After starting the Mako Server, use a browser and navigate to
http://localhost:portno, where portno is the HTTP port number used by
the Mako Server (printed in the console).

## 'LSP-Examples/Dashboard' Files:

```
|   build.lua -- Initial script used for extracting data from AdminLTE and inserting into AdminLTE.new
|
\---source -- Everything below should be copied to AdminLTE.new such that the directory includes AdminLTE.new/.preload
    |   .preload -- Loads cms.lua when server starts (copy to: AdminLTE.new/.preload)
    |
    \---.lua (copy to: AdminLTE.new/.lua/)
        |   cms.lua -- Mini Content Management System (CMS engine)
        |
        \---www (copy to: AdminLTE.new/.lua/www/)
                template.lsp -- AdminLTE page converted to a template page and used by CMS engine
```

## Notes:

The script 'build.lua' also creates the menu information file
AdminLTE.new/.lua/menu.json, a file that should normally be hand
crafted. We create this file automatically for the purpose of this
demo; creating the file automatically enables us to dynamically
extract and use most of the pages in the AdminLTE directory. The
extraction process is not perfect and you should consult the original
AdminLTE pages for details.

The page content extracted from the AdminLTE example pages are copied
to the AdminLTE.new/.lua/www/ directory with the extension ".html",
however, each page is executed as an LSP page thus LSP tags
(e.g. &lt;?lsp Lua code ?&gt;) can be inserted into any of these pages.

The Lua code in cms.lua reads and parses 'menu.json' at startup, and
creates two utility Lua tables used by the 'AdminLTE theme page'
template.lsp. The utility tables 'parentRefT' and 'breadcrumbT' are used
when dynamically generating the left side menu and the breadcrumb in
the top right corner. The tutorial
[Dynamic Navigation Menu](https://makoserver.net/articles/Dynamic-Navigation-Menu)
provides a good introduction to how the menu is generated by
template.lsp, but note that the menu generation for AdminLTE requires
additional complexity since the code must keep track of parent(s) for
sub-menus. The parent(s) must be expanded such that the selected
sub-menu is shown.

We use camel case naming convention in the example code. The Lua table
type implements associative arrays. An associative array is an array
that can be indexed not only with numbers, but also with keys such as
strings. We use the naming convention tableT when the table expects a
key based lookup and the naming convention tableL when the table is a
list (array).

## How to Create Your Own AdminLTE Based Dashboard Application

1. Copy all files in LSP-Examples/Dashboard/source/ to your-app/
2. Copy the directory 'dist' from AdminLTE/ to your-app/
2. Optionally copy the directory 'plugins' from AdminLTE/ to your-app/ or copy the plugins you plan on using, if any
3. Create the LSP pages that should be part of your application and put them in your-app/.lua/www/ or in a sub-directory
4. Hand-craft your-app/.lua/menu.json
5. Edit your-app/.lua/www/template.lsp as needed and make sure any
   JavaScript file required by the optional plugins you are using are
   included at the end of the file.

### menu.json format:

```
menu-list:
[
    menu-element1,
    menu-element2,
    ....
]

menu-element: // Leaf node
{
    "name": "link name",
    "class": "nav-icon", // And additional AdminLTE classes
    "href": "path"
}

menu-element: // directory
{
    "name": "link name",
    "class": "nav-icon", // And additional AdminLTE classes
    "href": "relative path", // or "#" if no page is associated with the directory
    "sub": menu-list
}
```
